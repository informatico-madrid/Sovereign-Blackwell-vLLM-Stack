# === PROFILE BLUEPRINT: Qwen3-Coder-30B-FP8 ===
# Optimized for: Dual RTX 5090 (sm_120) | Context: 256K (Native)

SERVED_MODEL_NAME=qwen3-30b-fp8
# Path relative to MODELS_ROOT defined in global .env
MODEL_PATH=${MODELS_ROOT}/qwen3-coder-30b-fp8

# VLLM FACTORY COMMAND
# --gpu-memory-utilization 0.86: Critical threshold for Blackwell NCCL buffers.
VLLM_LAUNCH_COMMAND="--model /model_dir \
  --served-model-name ${SERVED_MODEL_NAME} \
  --gpu-memory-utilization 0.86 \
  --max-model-len 262144 \
  --tensor-parallel-size 2 \
  --tool-call-parser qwen3_coder \
  --quantization fp8 \
  --dtype auto \
  --kv-cache-dtype auto \
  --enforce-eager \
  --distributed-executor-backend mp \
  --disable-custom-all-reduce \
  --enable-chunked-prefill \
  --attention-backend FLASHINFER \
  --max-num-seqs 1 \
  --enable-auto-tool-choice \
  --enable-prefix-caching \
  --disable-log-requests"

# CPU AFFINITY
# Maps to Threadripper CCD1 to minimize L3 cache latency
CPU_SET=0-7